<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Picker - Testing & Debug Console</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
        }
        
        .header {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #00ff00;
        }
        
        h1 {
            color: #00ff00;
            margin-bottom: 10px;
        }
        
        .section {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        h2 {
            color: #00aaff;
            margin-bottom: 15px;
            border-bottom: 2px solid #00aaff;
            padding-bottom: 5px;
        }
        
        .test-button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-weight: bold;
            border-radius: 4px;
            font-family: inherit;
        }
        
        .test-button:hover {
            background: #00cc00;
        }
        
        .test-button:active {
            background: #009900;
        }
        
        #console {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }
        
        .metric {
            display: inline-block;
            margin: 10px 20px 10px 0;
            padding: 10px 15px;
            background: #3a3a3a;
            border-radius: 4px;
            border-left: 3px solid #00aaff;
        }
        
        .metric-label {
            color: #00aaff;
            font-size: 12px;
            text-transform: uppercase;
        }
        
        .metric-value {
            color: #00ff00;
            font-size: 24px;
            font-weight: bold;
        }
        
        .color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 5px;
            margin-top: 10px;
        }
        
        .mini-color {
            aspect-ratio: 1;
            border: 1px solid #555;
            border-radius: 4px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .mini-color:hover {
            transform: scale(1.1);
            border: 2px solid #00ff00;
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin: 5px;
            font-weight: bold;
        }
        
        .status.pass {
            background: #004400;
            color: #00ff00;
        }
        
        .status.fail {
            background: #440000;
            color: #ff0000;
        }
        
        .status.warn {
            background: #443300;
            color: #ffaa00;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ”§ Color Picker Testing Console</h1>
        <p>Development and debugging interface</p>
    </div>

    <div class="section">
        <h2>System Status</h2>
        <div id="status-indicators"></div>
    </div>

    <div class="section">
        <h2>Quick Tests</h2>
        <button class="test-button" onclick="testColorGeneration()">Test Color Generation</button>
        <button class="test-button" onclick="testEloAlgorithm()">Test Elo Algorithm</button>
        <button class="test-button" onclick="testAccessibility()">Test Accessibility</button>
        <button class="test-button" onclick="testExport()">Test Export Functions</button>
        <button class="test-button" onclick="runAllTests()">Run All Tests</button>
        <button class="test-button" onclick="clearConsole()">Clear Console</button>
    </div>

    <div class="section">
        <h2>Metrics Dashboard</h2>
        <div id="metrics-dashboard"></div>
    </div>

    <div class="section">
        <h2>Color Visualization</h2>
        <div id="color-visualization" class="color-grid"></div>
    </div>

    <div class="section">
        <h2>Console Output</h2>
        <div id="console"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="picker-core.js"></script>
    <script>
        // Logging
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : type === 'warn' ? 'âš ï¸' : 'â„¹ï¸';
            console.innerHTML += `[${timestamp}] ${prefix} ${message}\n`;
            console.scrollTop = console.scrollHeight;
        }

        function clearConsole() {
            document.getElementById('console').innerHTML = '';
            log('Console cleared', 'info');
        }

        // Test Functions
        function testColorGeneration() {
            log('Testing color generation...', 'info');
            try {
                const colors = ColorPickerCore.generatePerceptuallyDistinctColors(200);
                
                if (colors.length !== 200) {
                    log(`FAIL: Expected 200 colors, got ${colors.length}`, 'error');
                    return false;
                }
                
                // Check for duplicates
                const hexSet = new Set(colors.map(c => c.hex));
                if (hexSet.size !== colors.length) {
                    log(`WARN: Found ${colors.length - hexSet.size} duplicate colors`, 'warn');
                }
                
                // Check color properties
                let allValid = true;
                colors.forEach((c, i) => {
                    if (!c.hex || !c.hsl || !c.rgb || c.eloRating !== 1500) {
                        log(`FAIL: Color ${i} has invalid properties`, 'error');
                        allValid = false;
                    }
                });
                
                if (allValid) {
                    log(`SUCCESS: Generated ${colors.length} valid colors`, 'success');
                    visualizeColors(colors.slice(0, 100)); // Show first 100
                }
                
                return allValid;
            } catch (e) {
                log(`ERROR: ${e.message}`, 'error');
                return false;
            }
        }

        function testEloAlgorithm() {
            log('Testing Elo algorithm...', 'info');
            try {
                const state = new ColorPickerCore.EloPickerState({
                    colorCount: 50,
                    generateColors: true,
                    defaultSettings: {
                        minBatchSize: 2,
                        maxBatchSize: 5
                    }
                });
                
                state.initialize();
                
                // Simulate 20 comparisons
                for (let i = 0; i < 20; i++) {
                    if (!state.evaluating || state.evaluating.length === 0) {
                        log('WARN: No more colors to evaluate', 'warn');
                        break;
                    }
                    
                    // Pick random colors from batch
                    const numPicks = Math.floor(Math.random() * state.evaluating.length) + 1;
                    const picked = state.evaluating.slice(0, numPicks).map(c => c.id);
                    
                    state.pick(picked);
                }
                
                log(`SUCCESS: Completed ${state.analytics.sessionComparisons} comparisons`, 'success');
                log(`Picks: ${state.analytics.picks}, Passes: ${state.analytics.passes}`, 'info');
                
                const topColors = state.getTopColors(5);
                log(`Top 5 colors by rating:`, 'info');
                topColors.forEach((c, i) => {
                    log(`  ${i+1}. ${c.hex} - Rating: ${Math.round(c.eloRating)} (${c.comparisons} comparisons)`, 'info');
                });
                
                updateMetrics(state.analytics);
                return true;
            } catch (e) {
                log(`ERROR: ${e.message}`, 'error');
                return false;
            }
        }

        function testAccessibility() {
            log('Testing accessibility features...', 'info');
            try {
                const testColor = {
                    rgb: { r: 255, g: 100, g: 50 }
                };
                
                // Test CVD simulations
                const modes = ['protanopia', 'deuteranopia', 'tritanopia'];
                modes.forEach(mode => {
                    const simulated = ColorPickerCore.simulateColorBlindness(testColor.rgb, mode);
                    if (simulated && simulated.r !== undefined) {
                        log(`SUCCESS: ${mode} simulation working`, 'success');
                    } else {
                        log(`FAIL: ${mode} simulation failed`, 'error');
                    }
                });
                
                // Test pattern generation
                for (let i = 0; i < 10; i++) {
                    const pattern = ColorPickerCore.getPatternForColor(i);
                    if (!pattern) {
                        log(`FAIL: Pattern generation failed for index ${i}`, 'error');
                        return false;
                    }
                }
                log('SUCCESS: Pattern generation working', 'success');
                
                return true;
            } catch (e) {
                log(`ERROR: ${e.message}`, 'error');
                return false;
            }
        }

        function testExport() {
            log('Testing export functions...', 'info');
            try {
                const colors = ColorPickerCore.generatePerceptuallyDistinctColors(10);
                
                // Test data structure
                const testExport = {
                    colors: colors.map((c, i) => ({
                        rank: i + 1,
                        hex: c.hex,
                        rgb: c.rgb,
                        hsl: c.hsl,
                        rating: Math.round(c.eloRating)
                    }))
                };
                
                // Test JSON serialization
                const json = JSON.stringify(testExport, null, 2);
                if (!json) {
                    log('FAIL: JSON export failed', 'error');
                    return false;
                }
                log('SUCCESS: JSON export working', 'success');
                
                // Test CSS generation
                let css = ':root {\n';
                colors.forEach((c, i) => {
                    css += `  --color-${i+1}: ${c.hex};\n`;
                });
                css += '}\n';
                if (!css) {
                    log('FAIL: CSS export failed', 'error');
                    return false;
                }
                log('SUCCESS: CSS export working', 'success');
                
                return true;
            } catch (e) {
                log(`ERROR: ${e.message}`, 'error');
                return false;
            }
        }

        function runAllTests() {
            log('======================================', 'info');
            log('Running all tests...', 'info');
            log('======================================', 'info');
            
            const tests = [
                { name: 'Color Generation', func: testColorGeneration },
                { name: 'Elo Algorithm', func: testEloAlgorithm },
                { name: 'Accessibility', func: testAccessibility },
                { name: 'Export Functions', func: testExport }
            ];
            
            let passed = 0;
            let failed = 0;
            
            tests.forEach(test => {
                log(`\nRunning: ${test.name}`, 'info');
                const result = test.func();
                if (result) {
                    passed++;
                } else {
                    failed++;
                }
            });
            
            log('======================================', 'info');
            log(`Tests Complete: ${passed} passed, ${failed} failed`, passed === tests.length ? 'success' : 'warn');
            log('======================================', 'info');
            
            updateSystemStatus(passed, failed);
        }

        function visualizeColors(colors) {
            const container = document.getElementById('color-visualization');
            container.innerHTML = '';
            
            colors.forEach(color => {
                const div = document.createElement('div');
                div.className = 'mini-color';
                div.style.backgroundColor = color.hex;
                div.title = `${color.hex}\nRating: ${Math.round(color.eloRating)}`;
                container.appendChild(div);
            });
        }

        function updateMetrics(analytics) {
            const dashboard = document.getElementById('metrics-dashboard');
            dashboard.innerHTML = `
                <div class="metric">
                    <div class="metric-label">Comparisons</div>
                    <div class="metric-value">${analytics.sessionComparisons || 0}</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Picks</div>
                    <div class="metric-value">${analytics.picks || 0}</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Passes</div>
                    <div class="metric-value">${analytics.passes || 0}</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Avg Time</div>
                    <div class="metric-value">${((analytics.averageDecisionTime || 0) / 1000).toFixed(1)}s</div>
                </div>
            `;
        }

        function updateSystemStatus(passed, failed) {
            const container = document.getElementById('status-indicators');
            const total = passed + failed;
            const percentage = total > 0 ? Math.round((passed / total) * 100) : 0;
            
            container.innerHTML = `
                <span class="status ${percentage === 100 ? 'pass' : percentage > 50 ? 'warn' : 'fail'}">
                    System Status: ${percentage}% Tests Passing
                </span>
                <span class="status ${percentage === 100 ? 'pass' : 'warn'}">
                    ${passed}/${total} Tests Passed
                </span>
            `;
        }

        // Initialize
        window.addEventListener('load', function() {
            log('Testing console initialized', 'success');
            log('Click "Run All Tests" to begin automated testing', 'info');
            log('Or use individual test buttons for specific checks', 'info');
            
            // Check if core library loaded
            if (typeof ColorPickerCore !== 'undefined') {
                log('âœ“ picker-core.js loaded successfully', 'success');
                updateSystemStatus(1, 0);
            } else {
                log('âœ— picker-core.js failed to load', 'error');
                updateSystemStatus(0, 1);
            }
        });
    </script>
</body>
</html>
